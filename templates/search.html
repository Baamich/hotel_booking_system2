{% extends "base.html" %}

{% block title %}{{ gettext('search_title', lang) }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <div class="dropdown">
        <button class="btn btn-outline-primary dropdown-toggle" type="button" id="filterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            {{ gettext('search_btn', lang) }}
        </button>
        <div class="dropdown-menu p-3" aria-labelledby="filterDropdown" style="min-width: 300px;">
            <form id="filter-form">
                <div class="mb-2">
                    <label for="city" class="form-label">{{ gettext('search_city', lang) }}</label>
                    <select name="city" id="city" class="form-select">
                        <option value="all">{{ gettext('all_categories', lang) }}</option>
                        {% for city in cities %}
                            <option value="{{ city }}">{{ city }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="mb-2">
                    <label for="min_price" id="min_price_label" class="form-label">{{ gettext('min_price', lang) }} ({{ currency_symbol }})</label>
                    <input type="number" name="min_price" id="min_price" class="form-control" min="0" step="0.01" value="0">
                </div>
                <div class="mb-2">
                    <label for="max_price" id="max_price_label" class="form-label">{{ gettext('max_price', lang) }} ({{ currency_symbol }})</label>
                    <input type="number" name="max_price" id="max_price" class="form-control" min="0" step="0.01" value="999999">
                </div>
                <div class="mb-2">
                    <label for="category" class="form-label">{{ gettext('category', lang) }}</label>
                    <select name="category" id="category" class="form-select">
                        <option value="all">{{ gettext('all_categories', lang) }}</option>
                        {% for cat in categories %}
                            <option value="{{ cat }}">{{ cat }} {{ gettext('stars', lang) }}</option>
                        {% endfor %}
                    </select>
                </div>
                <button type="submit" class="btn btn-primary w-100">{{ gettext('search_btn', lang) }}</button>
                <button type="button" id="reset-filter" class="btn btn-secondary w-100 mt-2">{{ gettext('reset_filter', lang) }}</button>
            </form>
        </div>
    </div>
</div>

<div class="row" id="hotels-row" data-lang="{{ lang }}" data-currency-symbol="{{ currency_symbol }}" data-currency="{{ session.get('currency', 'usd') }}">
    {% for hotel in hotels %}
        <div class="col-md-4 mb-3">
            <div class="card">
                {% if hotel.photos and hotel.photos|length > 0 %}
                    <img src="data:image/jpeg;base64,{{ hotel.photos[0] }}" class="card-img-top" alt="{{ hotel.name }}">
                {% else %}
                    <img src="https://via.placeholder.com/300x200?text={{ hotel.name }}" class="card-img-top" alt="{{ hotel.name }}">
                {% endif %}
                <div class="card-body">
                    <h5 class="card-title">{{ hotel.name }}</h5>
                    <p class="card-text price-text" data-price-usd="{{ hotel.price_usd }}">{{ hotel.city }} | {{ hotel.category }} {{ gettext('stars', lang) }} | {{ hotel.display_price }} {{ currency_symbol }} {{ gettext('per_night', lang) }}</p>
                    <a href="{{ url_for('search.hotel_detail', hotel_id=hotel._id) }}" class="btn btn-primary">{{ gettext('details', lang) }}</a>
                </div>
            </div>
        </div>
    {% endfor %}
</div>

<script src="{{ url_for('static', filename='js/search.js') }}"></script>
{% endblock %}