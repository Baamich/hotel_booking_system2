{% extends "base.html" %}

{% block title %}{{ gettext('profile_title', lang) }}{% endblock %}

{% block content %}
<div class="mb-3">
    <h2>{{ gettext('profile_title', lang) }}, {{ user.user_name }}</h2>
    <p>{{ gettext('profile_email', lang) }}: {{ user.user_email }}</p>
</div>

<h3>{{ gettext('bookings_history', lang) }}</h3>
{% if bookings %}
    <ul class="list-group">
        {% for booking in bookings %}
            <li class="list-group-item">
                {{ gettext('booking_item', lang).format(hotel_id=booking.hotel_id, date_from=booking.date_from, date_to=booking.date_to) }} 
                <a href="{{ url_for('booking.cancel_booking', booking_id=booking._id) }}" class="btn btn-sm btn-danger float-end">{{ gettext('cancel_btn', lang) }}</a>
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p>{{ gettext('no_bookings', lang) }}</p>
{% endif %}

<h3>{{ gettext('pending_applications', lang) }} ({{ applications|length }})</h3>
<div class="mb-3">
    <a href="{{ url_for('auth.owner_form') }}" class="btn btn-outline-primary">{{ gettext('owner_submit_btn', lang) }}</a>
    <a href="{{ url_for('support.chats') }}" class="btn btn-outline-primary">{{ gettext('support_btn', lang) }}</a>
</div>
{% if applications %}
    <button class="btn btn-outline-primary mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#applicationsCollapse" aria-expanded="false" aria-controls="applicationsCollapse">
        {{ gettext('toggle_applications', lang) }} ({{ applications|length }})
    </button>
    <div class="collapse" id="applicationsCollapse">
        <ul class="list-group">
            {% for app in applications %}
                <li class="list-group-item">
                    <strong>{{ app.hotel_data.get('name', 'Без названия') }}</strong> ({{ gettext('status_' + app.status, lang) }})<br>
                    <p><strong>{{ gettext('city', lang) }}:</strong> {{ app.hotel_data.get('city', 'Не указан') }}</p>
                    <p><strong>{{ gettext('price_usd', lang) }}:</strong> {{ app.hotel_data.get('price_usd', 0) }} USD</p>
                    <p><strong>{{ gettext('category', lang) }}:</strong> {{ app.hotel_data.get('category', 'Не указана') }} {{ gettext('stars', lang) }}</p>
                    <p><strong>{{ gettext('created_at', lang) }}:</strong> {{ app.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
                    {% if app.status == 'rejected' and app.rejection_reason %}
                        <p><strong>{{ gettext('rejection_reason', lang) }}:</strong> {{ app.rejection_reason }}</p>
                        <p><strong>{{ gettext('rejected_at', lang) }}:</strong> {{ app.updated_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    </div>
{% else %}
    <p>{{ gettext('no_pending_applications', lang) }}</p>
{% endif %}

{% endblock %}